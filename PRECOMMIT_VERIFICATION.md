# Pre-commit Hook éªŒè¯æŠ¥å‘Š

## âœ… å·²éªŒè¯çš„æ£€æŸ¥é¡¹

### 1. Prettier æ ¼å¼æ£€æŸ¥ âœ…

- **çŠ¶æ€**: æ­£å¸¸å·¥ä½œ
- **éªŒè¯æ–¹å¼**: æ‰‹åŠ¨è¿è¡Œ `npm run format`
- **ç»“æœ**: æˆåŠŸä¿®å¤äº†æ ¼å¼é—®é¢˜
  - ä¿®å¤äº† `const testVar=123` â†’ `const testVar = 123`ï¼ˆæ·»åŠ ç©ºæ ¼ï¼‰
  - ä¿®å¤äº†ç¼©è¿›é—®é¢˜

### 2. ESLint ä»£ç æ£€æŸ¥ âš ï¸

- **çŠ¶æ€**: é…ç½®æ­£ç¡®ï¼Œä½†æœ‰ Node.js ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
- **é—®é¢˜**: Node.js 16 ä¸æ”¯æŒ `structuredClone`ï¼ˆéœ€è¦ Node.js 17+ï¼‰
- **å»ºè®®**: å‡çº§ Node.js ç‰ˆæœ¬æˆ–ä½¿ç”¨å…¼å®¹çš„ ESLint é…ç½®

### 3. æµ‹è¯•æ£€æŸ¥ âœ…

- **çŠ¶æ€**: é…ç½®æ­£ç¡®
- **æµ‹è¯•æ–‡ä»¶**: `utils/precommit-test.test.ts` å·²åˆ›å»º
- **è¯´æ˜**: pre-commit hook ä¼šè¿è¡Œ `pnpm test` æ¥æ‰§è¡Œæ‰€æœ‰æµ‹è¯•

## ğŸ“‹ Pre-commit Hook é…ç½®

æ ¹æ® `.husky/pre-commit` æ–‡ä»¶ï¼Œæäº¤å‰ä¼šæ‰§è¡Œï¼š

1. **lint-staged** (è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜)
   - å¯¹ `*.{js,ts,vue}` æ–‡ä»¶è¿è¡Œ `eslint --fix`
   - å¯¹æ‰€æœ‰ç›¸å…³æ–‡ä»¶è¿è¡Œ `prettier --write`

2. **è¿è¡Œæ‰€æœ‰æµ‹è¯•**
   - æ‰§è¡Œ `pnpm test`
   - å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œä¼šé˜»æ­¢æäº¤

## ğŸ§ª å¦‚ä½•æ‰‹åŠ¨éªŒè¯ Pre-commit Hook

### æ–¹æ³• 1: åˆ›å»ºæœ‰é—®é¢˜çš„æ–‡ä»¶å¹¶å°è¯•æäº¤

```bash
# 1. åˆ›å»ºä¸€ä¸ªæœ‰æ ¼å¼é—®é¢˜çš„æ–‡ä»¶
echo "const test=123" > test-file.ts

# 2. æ·»åŠ åˆ°æš‚å­˜åŒº
git add test-file.ts

# 3. å°è¯•æäº¤ï¼ˆpre-commit hook ä¼šè‡ªåŠ¨è¿è¡Œï¼‰
git commit -m "test: éªŒè¯ pre-commit"

# å¦‚æœ hook æ­£å¸¸å·¥ä½œï¼š
# - Prettier ä¼šè‡ªåŠ¨ä¿®å¤æ ¼å¼
# - ESLint ä¼šæ£€æŸ¥ä»£ç 
# - æµ‹è¯•ä¼šè¿è¡Œ
# - å¦‚æœæœ‰é—®é¢˜ï¼Œæäº¤ä¼šè¢«é˜»æ­¢
```

### æ–¹æ³• 2: æ‰‹åŠ¨è¿è¡Œæ£€æŸ¥å‘½ä»¤

```bash
# è¿è¡Œ lint-stagedï¼ˆæ¨¡æ‹Ÿ pre-commitï¼‰
npx lint-staged

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# æ£€æŸ¥æ ¼å¼
pnpm format:check

# è¿è¡Œ lint
pnpm lint
```

## ğŸ”§ ç¡®ä¿ Pre-commit Hook æ­£å¸¸å·¥ä½œ

å¦‚æœ pre-commit hook æ²¡æœ‰è¿è¡Œï¼Œå¯èƒ½éœ€è¦ï¼š

1. **åˆå§‹åŒ– Husky**:

   ```bash
   npm run prepare
   # æˆ–
   pnpm prepare
   ```

2. **æ£€æŸ¥ hook æ–‡ä»¶æƒé™**:

   ```bash
   ls -la .git/hooks/pre-commit
   chmod +x .git/hooks/pre-commit
   ```

3. **éªŒè¯ Husky é…ç½®**:
   ```bash
   cat .husky/pre-commit
   ```

## ğŸ“ æµ‹è¯•æ–‡ä»¶è¯´æ˜

`utils/precommit-test.test.ts` æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œç”¨äºéªŒè¯ï¼š

- Prettier æ ¼å¼æ£€æŸ¥
- ESLint ä»£ç æ£€æŸ¥
- æµ‹è¯•è¿è¡Œ

è¿™ä¸ªæ–‡ä»¶å¯ä»¥ä¿ç•™ç”¨äºåç»­éªŒè¯ï¼Œä¹Ÿå¯ä»¥åˆ é™¤ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Node.js ç‰ˆæœ¬**: å»ºè®®ä½¿ç”¨ Node.js 18+ ä»¥é¿å…å…¼å®¹æ€§é—®é¢˜
2. **ä¾èµ–å®‰è£…**: ç¡®ä¿å·²è¿è¡Œ `npm install` æˆ– `pnpm install`
3. **Husky åˆå§‹åŒ–**: é¦–æ¬¡å…‹éš†é¡¹ç›®åéœ€è¦è¿è¡Œ `npm run prepare`
